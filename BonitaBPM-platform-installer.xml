<project>
    <shortName>BonitaBPMPlatform</shortName>
    <fullName>BonitaBPM Platform</fullName>
    <version>1.0</version>
    <leftImage>C:\Users\Romain\git\bonita-platform-installer\img\leftImage.png</leftImage>
    <logoImage>C:\Users\Romain\git\bonita-platform-installer\img\topRight.png</logoImage>
    <allowLanguageSelection>1</allowLanguageSelection>
    <componentList>
        <component>
            <name>jre</name>
            <description>JRE</description>
            <canBeEdited>1</canBeEdited>
            <selected>0</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Java Runtime Environment</description>
                    <destination>${jreinstalldir}</destination>
                    <name>jre</name>
                    <platforms>all</platforms>
                </folder>
            </folderList>
            <parameterList>
                <directoryParameter>
                    <name>jreinstalldir</name>
                    <title>jre.installdir.title</title>
                    <description>jre.installdir.label</description>
                    <explanation>jre.installdir.description</explanation>
                    <value></value>
                    <default>${installdir}</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <mustBeWritable>1</mustBeWritable>
                    <mustExist>0</mustExist>
                    <width>40</width>
                </directoryParameter>
            </parameterList>
            <postInstallationActionList>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-linux</value>
                    <ruleList>
                        <platformTest>
                            <type>linux-x86</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-linux-x64</value>
                    <ruleList>
                        <platformTest>
                            <type>linux-x64</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-windows</value>
                    <ruleList>
                        <platformTest>
                            <type>windows-x86</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-windows-x64</value>
                    <ruleList>
                        <platformTest>
                            <type>windows-x64</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-osx</value>
                    <ruleList>
                        <platformTest>
                            <type>osx-intel</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <httpGet>
                    <filename>${jreinstalldir}/jre.zip</filename>
                    <url>http://repositories.rd.lan/tools/studio-tools/${jrePlatform}.zip</url>
                </httpGet>
                <unzip>
                    <destinationDirectory>${jreinstalldir}</destinationDirectory>
                    <zipFile>${jreinstalldir}/jre.zip</zipFile>
                </unzip>
                <deleteFile>
                    <path>${jreinstalldir}/jre.zip</path>
                </deleteFile>
                <setInstallerVariable>
                    <name>jre_home</name>
                    <value>${jreinstalldir}/${jrePlatform}/jre</value>
                </setInstallerVariable>
                <changePermissions>
                    <files>${jre_home}/bin/*</files>
                    <permissions>755</permissions>
                </changePermissions>
            </postInstallationActionList>
        </component>
        <component>
            <name>bonitaPlatform</name>
            <description>BonitaBPM Platform</description>
            <canBeEdited>0</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Postgres Install Folder</description>
                    <destination>${postgresinstalldir}/pgsql</destination>
                    <name>postgresFolder</name>
                    <platforms>all</platforms>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </folder>
                <folder>
                    <description>db drivers</description>
                    <destination>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/lib/bonita</destination>
                    <name>drivers</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>${build_project_directory}/drivers/postgresql-9.2-1003-jdbc4.jar</origin>
                        </distributionFile>
                    </distributionFileList>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </folder>
            </folderList>
            <parameterList>
                <directoryParameter>
                    <name>installdir</name>
                    <description>Installer.Parameter.installdir.description</description>
                    <explanation>Installer.Parameter.installdir.explanation</explanation>
                    <value></value>
                    <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <mustBeWritable>1</mustBeWritable>
                    <mustExist>0</mustExist>
                    <width>40</width>
                    <validationActionList>
                        <createDirectory>
                            <path>${installdir}</path>
                        </createDirectory>
                    </validationActionList>
                </directoryParameter>
                <parameterGroup>
                    <name>platformConfiguration</name>
                    <title>Platform configuration</title>
                    <explanation>Platform configuration</explanation>
                    <value></value>
                    <default></default>
                    <parameterList>
                        <stringParameter>
                            <name>tomcatPort</name>
                            <title>Tomcat port</title>
                            <description>Tomcat port</description>
                            <explanation></explanation>
                            <value></value>
                            <default>${tomcatDefaultPort}</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>30</width>
                            <preShowPageActionList>
                                <getFreePort>
                                    <finalPort>9999</finalPort>
                                    <initialPort>9000</initialPort>
                                    <variable>tomcatDefaultPort</variable>
                                </getFreePort>
                            </preShowPageActionList>
                        </stringParameter>
                        <directoryParameter>
                            <name>bonita_home</name>
                            <description>Bonita home folder</description>
                            <explanation>Bonita home is the main BonitaBPM configuration folder (leave it empty to use default value)</explanation>
                            <value></value>
                            <default></default>
                            <allowEmptyValue>1</allowEmptyValue>
                            <mustBeWritable>0</mustBeWritable>
                            <mustExist>0</mustExist>
                            <width>40</width>
                            <postShowPageActionList>
                                <createDirectory>
                                    <path>${bonita_home}</path>
                                    <ruleList>
                                        <fileExists>
                                            <negate>1</negate>
                                            <path>${bonita_home}</path>
                                        </fileExists>
                                    </ruleList>
                                </createDirectory>
                            </postShowPageActionList>
                        </directoryParameter>
                        <booleanParameterGroup>
                            <name>advancedPlatformConfiguration</name>
                            <description>Advanced</description>
                            <explanation></explanation>
                            <value></value>
                            <default></default>
                            <validationType>ifSelected</validationType>
                            <parameterList>
                                <stringParameter>
                                    <name>platformAdmin</name>
                                    <title>Platform administrator username</title>
                                    <description>Platform admin username</description>
                                    <explanation></explanation>
                                    <value></value>
                                    <default>platformAdmin</default>
                                    <allowEmptyValue>0</allowEmptyValue>
                                    <width>30</width>
                                </stringParameter>
                                <passwordParameter>
                                    <name>platformPassword</name>
                                    <title>Platform administrator password</title>
                                    <description>Platform admin password</description>
                                    <explanation></explanation>
                                    <value></value>
                                    <default>platformPassword</default>
                                    <allowEmptyValue>0</allowEmptyValue>
                                    <askForConfirmation>0</askForConfirmation>
                                    <descriptionRetype>Confirm password</descriptionRetype>
                                    <width>20</width>
                                </passwordParameter>
                            </parameterList>
                        </booleanParameterGroup>
                    </parameterList>
                </parameterGroup>
                <parameterGroup>
                    <name>defaultTenantConfig</name>
                    <title>Default Tenant Configuration</title>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <parameterList>
                        <stringParameter>
                            <name>tenantadminusername</name>
                            <title>Set the default tenant username</title>
                            <description>Username</description>
                            <explanation></explanation>
                            <value></value>
                            <default>living_admin</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>30</width>
                        </stringParameter>
                        <passwordParameter>
                            <name>tenantadminpassword</name>
                            <title>Tenant admin password</title>
                            <description>Password</description>
                            <explanation></explanation>
                            <value></value>
                            <default></default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <descriptionRetype>Confirm password</descriptionRetype>
                            <width>20</width>
                        </passwordParameter>
                    </parameterList>
                </parameterGroup>
                <choiceParameter>
                    <name>dbVendor</name>
                    <title>db.vendor.title</title>
                    <description>db.vendor.description</description>
                    <explanation>db.vendor.description</explanation>
                    <value></value>
                    <default>h2</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <displayType>radiobuttons</displayType>
                    <ordering>default</ordering>
                    <width>30</width>
                    <optionList>
                        <option>
                            <description>${msg(h2.option.description)}</description>
                            <image>${build_project_directory}/img/h2.png</image>
                            <text>H2</text>
                            <value>h2</value>
                        </option>
                        <option>
                            <description>${msg(postgres.option.description)}</description>
                            <image>${build_project_directory}/img/postgresql.png</image>
                            <text>PostgreSQL</text>
                            <value>postgres</value>
                        </option>
                    </optionList>
                </choiceParameter>
                <parameterGroup>
                    <name>db_parameter_group</name>
                    <title>Database details</title>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <parameterList>
                        <stringParameter>
                            <name>dbUsername</name>
                            <description>Username</description>
                            <explanation></explanation>
                            <value></value>
                            <default>${default_db_username}</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>30</width>
                        </stringParameter>
                        <passwordParameter>
                            <name>dbPassword</name>
                            <description>Password</description>
                            <explanation></explanation>
                            <value></value>
                            <default></default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <descriptionRetype>Confirm</descriptionRetype>
                            <width>20</width>
                        </passwordParameter>
                        <stringParameter>
                            <name>db_port</name>
                            <description>Port</description>
                            <explanation></explanation>
                            <value></value>
                            <default>${db_default_port}</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>30</width>
                        </stringParameter>
                    </parameterList>
                    <postShowPageActionList>
                        <if>
                            <actionList>
                                <setInstallerVariable>
                                    <name>jdbc.driver</name>
                                    <value>org.h2.Driver</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.url</name>
                                    <value>jdbc:h2:tcp://localhost:${db_port}/bonita_journal.db;MVCC=TRUE;DB_CLOSE_ON_EXIT=TRUE;IGNORECASE=TRUE;</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.xa.driver</name>
                                    <value>org.h2.jdbcx.JdbcDataSource</value>
                                </setInstallerVariable>
                            </actionList>
                            <conditionRuleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${dbVendor}</value1>
                                    <value2>h2</value2>
                                </compareValues>
                            </conditionRuleList>
                            <elseActionList>
                                <setInstallerVariable>
                                    <name>jdbc.driver</name>
                                    <value>org.postgresql.Driver</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.url</name>
                                    <value>jdbc:postgresql://localhost:${db_port}/${postgres_db_name}</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.xa.driver</name>
                                    <value>org.postgresql.xa.PGXADataSource</value>
                                </setInstallerVariable>
                            </elseActionList>
                        </if>
                    </postShowPageActionList>
                    <preShowPageActionList>
                        <setInstallerVariable>
                            <name>default_db_username</name>
                            <value>sa</value>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${dbVendor}</value1>
                                    <value2>h2</value2>
                                </compareValues>
                            </ruleList>
                        </setInstallerVariable>
                        <setInstallerVariable>
                            <name>default_db_username</name>
                            <value>living_user</value>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${dbVendor}</value1>
                                    <value2>postgres</value2>
                                </compareValues>
                            </ruleList>
                        </setInstallerVariable>
                        <getFreePort>
                            <finalPort>9999</finalPort>
                            <initialPort>5432</initialPort>
                            <variable>db_default_port</variable>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${dbVendor}</value1>
                                    <value2>postgres</value2>
                                </compareValues>
                            </ruleList>
                        </getFreePort>
                        <getFreePort>
                            <finalPort>9999</finalPort>
                            <initialPort>9091</initialPort>
                            <variable>db_default_port</variable>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${dbVendor}</value1>
                                    <value2>h2</value2>
                                </compareValues>
                            </ruleList>
                        </getFreePort>
                    </preShowPageActionList>
                </parameterGroup>
                <parameterGroup>
                    <name>postgres_parameter_group</name>
                    <title>PostgreSQL configuration</title>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <parameterList>
                        <directoryParameter>
                            <name>postgresinstalldir</name>
                            <description>Install path</description>
                            <explanation></explanation>
                            <value></value>
                            <default>${installdir}/postgres</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <mustBeWritable>1</mustBeWritable>
                            <mustExist>0</mustExist>
                            <width>40</width>
                            <validationActionList>
                                <createDirectory>
                                    <path>${postgresinstalldir}</path>
                                </createDirectory>
                            </validationActionList>
                        </directoryParameter>
                        <stringParameter>
                            <name>postgres_db_name</name>
                            <description>Bonita database name</description>
                            <explanation></explanation>
                            <value></value>
                            <default>living_db</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>30</width>
                        </stringParameter>
                        <stringParameter>
                            <name>locale</name>
                            <description>Locale</description>
                            <explanation></explanation>
                            <value></value>
                            <default>${system_locale}</default>
                            <allowEmptyValue>0</allowEmptyValue>
                            <width>40</width>
                        </stringParameter>
                    </parameterList>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </parameterGroup>
            </parameterList>
            <postInstallationActionList>
                <httpGet>
                    <filename>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37.zip</filename>
                    <url>http://192.168.0.53:8000/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37.zip</url>
                </httpGet>
                <unzip>
                    <destinationDirectory>${installdir}</destinationDirectory>
                    <zipFile>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37.zip</zipFile>
                </unzip>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/client/platform/conf/platform-tenant-config.properties</file>
                    <key>platform.tenant.default.username</key>
                    <value>${tenantadminusername}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/client/platform/conf/platform-tenant-config.properties</file>
                    <key>platform.tenant.default.password</key>
                    <value>${tenantadminpassword}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita Platform username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/conf/bonita-platform.properties</file>
                    <key>platformAdminUsername</key>
                    <value>${platformAdmin}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita Platform password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/conf/bonita-platform.properties</file>
                    <key>platformAdminPassword</key>
                    <value>${platformPassword}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/tenant-template/conf/bonita-server.properties</file>
                    <key>userName</key>
                    <value>${tenantadminusername}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/tenant-template/conf/bonita-server.properties</file>
                    <key>userPassword</key>
                    <value>${tenantadminpassword}</value>
                </propertiesFileSet>
                <xmlFileSet>
                    <attribute>username</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${dbUsername}</value>
                </xmlFileSet>
                <xmlFileSet>
                    <attribute>password</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${dbPassword}</value>
                </xmlFileSet>
                <xmlFileSet>
                    <attribute>url</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${jdbc.url}</value>
                </xmlFileSet>
                <xmlFileSet>
                    <attribute>driverClassName</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${jdbc.driver}</value>
                </xmlFileSet>
                <addTextToFile>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.sh</file>
                    <text>export JRE_HOME=${jre_home}</text>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <negate>1</negate>
                            <value1>${jre_home}</value1>
                            <value2></value2>
                        </compareValues>
                    </ruleList>
                </addTextToFile>
                <addTextToFile>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.bat</file>
                    <text>set JRE_HOME=${jre_home}</text>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <negate>1</negate>
                            <value1>${jre_home}</value1>
                            <value2></value2>
                        </compareValues>
                    </ruleList>
                </addTextToFile>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.className</key>
                    <value>${jdbc.xa.driver}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.user</key>
                    <value>${dbUsername}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.password</key>
                    <value>${dbPassword}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.URL</key>
                    <value>${jdbc.url}</value>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>h2</value2>
                        </compareValues>
                    </ruleList>
                </propertiesFileSet>
                <substitute>
                    <files>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</files>
                    <type>regexp</type>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>^resource.ds1.driverProperties.URL.*$</pattern>
                            <value></value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.serverName</key>
                    <value>localhost</value>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </propertiesFileSet>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.portNumber</key>
                    <value>${db_port}</value>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </propertiesFileSet>
                <propertiesFileSet>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/bitronix-resources.properties</file>
                    <key>resource.ds1.driverProperties.databaseName</key>
                    <value>${postgres_db_name}</value>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </propertiesFileSet>
                <xmlFileSet>
                    <attribute>port</attribute>
                    <element>//Service[@name="Catalina"]/Connector[@protocol="HTTP/1.1"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/server.xml</file>
                    <value>${tomcatPort}</value>
                </xmlFileSet>
                <xmlFileSet>
                    <attribute>tcpPort</attribute>
                    <element>//Listener[@className="org.bonitasoft.tomcat.H2Listener"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/server.xml</file>
                    <value>${db_port}</value>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>h2</value2>
                        </compareValues>
                    </ruleList>
                </xmlFileSet>
                <actionGroup>
                    <explanation>postgres.configuration</explanation>
                    <progressText>Configuring Postgres Database...</progressText>
                    <actionList>
                        <setInstallerVariable>
                            <name>pgsqlPlatform</name>
                            <value>linux-x64</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux-x64</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <setInstallerVariable>
                            <name>pgsqlPlatform</name>
                            <value>windows-x64</value>
                            <ruleList>
                                <platformTest>
                                    <type>windows-x64</type>
                                </platformTest>
                            </ruleList>
                        </setInstallerVariable>
                        <httpGet>
                            <filename>${installdir}/postgresql-9.1.13-4-${pgsqlPlatform}-binaries.zip</filename>
                            <url>http://192.168.0.53:8000/postgresql-9.1.13-4-${pgsqlPlatform}-binaries.zip</url>
                        </httpGet>
                        <unzip>
                            <destinationDirectory>${postgresinstalldir}</destinationDirectory>
                            <zipFile>${installdir}/postgresql-9.1.13-4-${pgsqlPlatform}-binaries.zip</zipFile>
                        </unzip>
                        <createDirectory>
                            <path>${postgresinstalldir}/pgsql/data</path>
                        </createDirectory>
                        <setWindowsACL>
                            <action>allow</action>
                            <files>${postgresinstalldir}/pgsql/data</files>
                            <permissions>file_all_access</permissions>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </setWindowsACL>
                        <setEnvironmentVariable>
                            <name>PGDATA</name>
                            <value>${postgresinstalldir}/pgsql/data</value>
                        </setEnvironmentVariable>
                        <runProgram>
                            <program>${postgresinstalldir}/pgsql/bin/initdb</program>
                            <programArguments>--encoding=UNICODE</programArguments>
                        </runProgram>
                        <addTextToFile>
                            <file>${postgresinstalldir}/pgsql/data/pg_hba.conf</file>
                            <text>host all  all    0.0.0.0/0  md5</text>
                        </addTextToFile>
                        <propertiesFileSet>
                            <file>${postgresinstalldir}/pgsql/data/postgresql.conf</file>
                            <key>listen_addresses</key>
                            <value>'*'</value>
                        </propertiesFileSet>
                        <propertiesFileSet>
                            <file>${postgresinstalldir}/pgsql/data/postgresql.conf</file>
                            <key>max_connections</key>
                            <value>10</value>
                        </propertiesFileSet>
                        <propertiesFileSet>
                            <file>${postgresinstalldir}/pgsql/data/postgresql.conf</file>
                            <key>max_prepared_transactions</key>
                            <value>10</value>
                        </propertiesFileSet>
                        <propertiesFileSet>
                            <file>${postgresinstalldir}/pgsql/data/postgresql.conf</file>
                            <key>port</key>
                            <value>${db_port}</value>
                        </propertiesFileSet>
                        <waitForPort>
                            <port>${db_port}</port>
                            <state>in_use</state>
                            <timeout>10000</timeout>
                        </waitForPort>
                        <wait>
                            <ms>5000</ms>
                        </wait>
                        <runProgram>
                            <program>${postgresinstalldir}/pgsql/bin/pg_ctl</program>
                            <programArguments>start -w -t 10 -l postgresql.log</programArguments>
                            <progressText>Starting PostgreSQL server...</progressText>
                            <useMSDOSPath>0</useMSDOSPath>
                            <onErrorActionList>
                                <throwError>
                                    <text>Fail to start Postgres database :(</text>
                                </throwError>
                            </onErrorActionList>
                        </runProgram>
                        <runProgram>
                            <program>${postgresinstalldir}/pgsql/bin/psql</program>
                            <programArguments>-p ${db_port} -d postgres -c "CREATE ROLE ${dbUsername} WITH LOGIN PASSWORD '${dbPassword}'"</programArguments>
                            <progressText>Creating Bonita BPM user...</progressText>
                        </runProgram>
                        <runProgram>
                            <program>${postgresinstalldir}/pgsql/bin/psql</program>
                            <programArguments>-p ${db_port} -d postgres -c "CREATE DATABASE ${postgres_db_name}"</programArguments>
                        </runProgram>
                        <runProgram>
                            <program>${postgresinstalldir}/pgsql/bin/psql</program>
                            <programArguments>-p ${db_port} -d postgres -c "GRANT ALL PRIVILEGES ON DATABASE ${postgres_db_name} TO ${dbUsername}"</programArguments>
                        </runProgram>
                    </actionList>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${dbVendor}</value1>
                            <value2>postgres</value2>
                        </compareValues>
                    </ruleList>
                </actionGroup>
                <substitute>
                    <files>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.*</files>
                    <type>regexp</type>
                    <substitutionList>
                        <substitution>
                            <pattern>h2</pattern>
                            <value>${dbVendor}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <substitute>
                    <files>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.sh</files>
                    <type>regexp</type>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <negate>1</negate>
                            <value1>${bonita_home}</value1>
                            <value2></value2>
                        </compareValues>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>-Dbonita.home=.*$</pattern>
                            <value>-Dbonita.home=${bonita_home}/bonita"</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <substitute>
                    <files>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.bat</files>
                    <type>regexp</type>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <negate>1</negate>
                            <value1>${bonita_home}</value1>
                            <value2></value2>
                        </compareValues>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>-Dbonita.home=.*$</pattern>
                            <value>-Dbonita.home=${bonita_home}\bonita"</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <renameFile>
                    <destination>${bonita_home}</destination>
                    <origin>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita</origin>
                    <ruleList>
                        <compareValues>
                            <logic>equals</logic>
                            <negate>1</negate>
                            <value1>${bonita_home}</value1>
                            <value2></value2>
                        </compareValues>
                    </ruleList>
                </renameFile>
            </postInstallationActionList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}</comment>
                    <name>Uninstall ${product_fullname}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
    </componentList>
    <preInstallationActionList>
        <setInstallerVariable>
            <name>jre_home</name>
            <value></value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>catalinaExec</name>
            <value>catalina.sh</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>catalinaExec</name>
            <value>catalina.bat</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
    </preInstallationActionList>
    <postUninstallerCreationActionList>
        <deleteFile>
            <path>${installdir}/*.zip</path>
        </deleteFile>
    </postUninstallerCreationActionList>
    <postUninstallationActionList>
        <deleteFile>
            <path>${installdir}/*</path>
        </deleteFile>
    </postUninstallationActionList>
    <allowComponentSelection>1</allowComponentSelection>
    <componentsDirectory>.</componentsDirectory>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <height>450</height>
    <vendor>Bonitasoft</vendor>
    <customLanguageFileList>
        <language>
            <code>en</code>
            <encoding>utf-8</encoding>
            <file>${build_project_directory}/I18n/messages.properties</file>
        </language>
    </customLanguageFileList>
    <finalPageActionList>
        <actionGroup>
            <progressText>Start BonitaBPM Platform</progressText>
            <actionList>
                <runProgram>
                    <explanation>Start BonitaBPM Platform</explanation>
                    <program>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/${catalinaExec}</program>
                    <programArguments>start</programArguments>
                </runProgram>
                <wait>
                    <ms>5000</ms>
                </wait>
                <launchBrowser>
                    <url>http://localhost:${tomcatPort}/bonita</url>
                </launchBrowser>
            </actionList>
        </actionGroup>
    </finalPageActionList>
    <licenseFileList>
        <licenseFile>
            <code>en</code>
            <encoding>utf-8</encoding>
            <file>${build_project_directory}/gpl-2.0.txt</file>
        </licenseFile>
    </licenseFileList>
    <parameterList>
        <licenseParameter>
            <name>licenseFile</name>
            <title>License Agreement</title>
            <description>Please read the following License Agreement. You must accept the terms of this agreement before continuing with the installation.</description>
            <explanation></explanation>
            <file>${build_project_directory}/gpl-2.0.txt</file>
            <fileEncoding>utf-8</fileEncoding>
            <htmlFile></htmlFile>
        </licenseParameter>
    </parameterList>
</project>

