<project>
    <shortName>BonitaBPMPlatform</shortName>
    <fullName>BonitaBPM Platform</fullName>
    <version>1.0</version>
    <allowLanguageSelection>1</allowLanguageSelection>
    <componentList>
        <component>
            <name>bonitaPlatform</name>
            <description>BonitaBPM Platform</description>
            <canBeEdited>0</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <parameterList>
                <stringParameter>
                    <name>tomcatPort</name>
                    <title>Tomcat port</title>
                    <description></description>
                    <explanation></explanation>
                    <value></value>
                    <default>8080</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>30</width>
                </stringParameter>
                <directoryParameter>
                    <name>installdir</name>
                    <description>Installer.Parameter.installdir.description</description>
                    <explanation>Installer.Parameter.installdir.explanation</explanation>
                    <value></value>
                    <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <cliOptionName>install_dir</cliOptionName>
                    <mustBeWritable>1</mustBeWritable>
                    <mustExist>0</mustExist>
                    <width>40</width>
                </directoryParameter>
                <stringParameter>
                    <name>tenantadminusername</name>
                    <title>Set the default tenant username</title>
                    <description>Default tenant username</description>
                    <explanation></explanation>
                    <value></value>
                    <default>living</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>30</width>
                </stringParameter>
                <stringParameter>
                    <name>tenantadminpassword</name>
                    <title>Set the default tenant pasword</title>
                    <description>Default tenant password</description>
                    <explanation></explanation>
                    <value></value>
                    <default>day</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>30</width>
                </stringParameter>
                <stringParameter>
                    <name>platformAdmin</name>
                    <title>Platform administrator name</title>
                    <description></description>
                    <explanation></explanation>
                    <value></value>
                    <default>platformAdmin</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>30</width>
                </stringParameter>
                <passwordParameter>
                    <name>platformPassword</name>
                    <title>Platform administrator password</title>
                    <description></description>
                    <explanation></explanation>
                    <value></value>
                    <default>platformPassword</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <descriptionRetype></descriptionRetype>
                    <width>20</width>
                </passwordParameter>
                <stringParameter>
                    <name>dbUsername</name>
                    <description></description>
                    <explanation></explanation>
                    <value></value>
                    <default>sa</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>30</width>
                </stringParameter>
                <passwordParameter>
                    <name>dbPassword</name>
                    <description></description>
                    <explanation></explanation>
                    <value></value>
                    <default>root</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <descriptionRetype></descriptionRetype>
                    <width>20</width>
                </passwordParameter>
                <choiceParameter>
                    <name>dbVendor</name>
                    <title>db.vendor.title</title>
                    <description>db.vendor.description</description>
                    <explanation>db.vendor.description</explanation>
                    <value></value>
                    <default>h2</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <displayType>radiobuttons</displayType>
                    <ordering>default</ordering>
                    <width>30</width>
                    <optionList>
                        <option>
                            <description>${msg(h2.option.description)}</description>
                            <image>${build_project_directory}/img/h2.png</image>
                            <text>H2</text>
                            <value>h2</value>
                        </option>
                        <option>
                            <description>${msg(postgres.option.description)}</description>
                            <image>${build_project_directory}/img/postgresql.png</image>
                            <text>PostgreSQL</text>
                            <value>postgres</value>
                        </option>
                    </optionList>
                    <postShowPageActionList>
                        <if>
                            <actionList>
                                <setInstallerVariable>
                                    <name>jdbc.driver</name>
                                    <value>org.h2.Driver</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.url</name>
                                    <value>jdbc:h2:tcp://localhost:9091/bonita_journal.db;MVCC=TRUE;DB_CLOSE_ON_EXIT=TRUE;IGNORECASE=TRUE;</value>
                                </setInstallerVariable>
                            </actionList>
                            <conditionRuleList>
                                <isTrue>
                                    <value>${h2}</value>
                                </isTrue>
                            </conditionRuleList>
                            <elseActionList>
                                <setInstallerVariable>
                                    <name>jdbc.driver</name>
                                    <value>org.postgresql.Driver</value>
                                </setInstallerVariable>
                                <setInstallerVariable>
                                    <name>jdbc.url</name>
                                    <value>jdbc:postgresql://${postgres_host}:${postgres_port}/${postgres_db_name}</value>
                                </setInstallerVariable>
                            </elseActionList>
                        </if>
                    </postShowPageActionList>
                </choiceParameter>
            </parameterList>
            <postInstallationActionList>
                <copyFile>
                    <destination>${installdir}</destination>
                    <origin>/home/emmanuel/_work/living-day-2-innovation-week/bonitabpmplatforminstaller-1.0/bundle.zip</origin>
                </copyFile>
                <unzip>
                    <destinationDirectory>${installdir}</destinationDirectory>
                    <zipFile>${installdir}/bundle.zip</zipFile>
                </unzip>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/client/platform/conf/platform-tenant-config.properties</file>
                    <key>platform.tenant.default.username</key>
                    <value>${tenantadminusername}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/client/platform/conf/platform-tenant-config.properties</file>
                    <key>platform.tenant.default.password</key>
                    <value>${tenantadminpassword}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita Platform username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/conf/bonita-platform.properties</file>
                    <key>platformAdminUsername</key>
                    <value>${platformAdmin}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita Platform password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/conf/bonita-platform.properties</file>
                    <key>platformAdminPassword</key>
                    <value>${platformPassword}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant username</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/tenant-template/conf/bonita-server.properties</file>
                    <key>userName</key>
                    <value>${tenantadminusername}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                    <explanation>Updating bonita default Tenant password</explanation>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bonita/server/platform/tenant-template/conf/bonita-server.properties</file>
                    <key>userPassword</key>
                    <value>${tenantadminpassword}</value>
                </propertiesFileSet>
                <substitute>
                    <files>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/bin/setenv.sh</files>
                    <type>regexp</type>
                    <substitutionList>
                        <substitution>
                            <pattern>h2</pattern>
                            <value>${dbVendor}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <xmlFileSet>
                    <attribute>username</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${dbUsername}</value>
                </xmlFileSet>
                <xmlFileSet>
                    <attribute>password</attribute>
                    <element>//Context/Resource[@name="bonitaSequenceManagerDS"]</element>
                    <file>${installdir}/BonitaBPMCommunity-6.3.2-Tomcat-6.0.37/conf/Catalina/localhost/bonita.xml</file>
                    <value>${dbPassword}</value>
                </xmlFileSet>
            </postInstallationActionList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}</comment>
                    <name>Uninstall ${product_fullname}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
        <component>
            <name>postgresDatabase</name>
            <description>Postgres Database</description>
            <canBeEdited>1</canBeEdited>
            <selected>0</selected>
            <show>0</show>
        </component>
        <component>
            <name>jre</name>
            <description>JRE</description>
            <canBeEdited>1</canBeEdited>
            <selected>0</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Java Runtime Environment</description>
                    <destination>${jreinstalldir}</destination>
                    <name>jre</name>
                    <platforms>all</platforms>
                </folder>
            </folderList>
            <parameterList>
                <directoryParameter>
                    <name>jreinstalldir</name>
                    <title>jre.installdir.title</title>
                    <description>jre.installdir.label</description>
                    <explanation>jre.installdir.description</explanation>
                    <value></value>
                    <default>${installdir}</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <cliOptionName>jre_install_dir</cliOptionName>
                    <mustBeWritable>1</mustBeWritable>
                    <mustExist>0</mustExist>
                    <width>40</width>
                </directoryParameter>
            </parameterList>
            <postInstallationActionList>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-linux</value>
                    <ruleList>
                        <platformTest>
                            <type>linux-x86</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-linux-x64</value>
                    <ruleList>
                        <platformTest>
                            <type>linux-x64</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-windows</value>
                    <ruleList>
                        <platformTest>
                            <type>windows-x86</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-windows-x64</value>
                    <ruleList>
                        <platformTest>
                            <type>windows-x64</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>jrePlatform</name>
                    <value>jre1.7.0_55-osx</value>
                    <ruleList>
                        <platformTest>
                            <type>osx-intel</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
                <httpGet>
                    <filename>${jreinstalldir}\jre.zip</filename>
                    <url>http://repositories.rd.lan/tools/studio-tools/${jrePlatform}.zip</url>
                </httpGet>
                <unzip>
                    <destinationDirectory>${jreinstalldir}</destinationDirectory>
                    <zipFile>${jreinstalldir}/jre.zip</zipFile>
                </unzip>
                <deleteFile>
                    <path>${jreinstalldir}/jre7.zip</path>
                </deleteFile>
            </postInstallationActionList>
        </component>
        <component>
            <name>h2Database</name>
            <description>H2 Database</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>0</show>
        </component>
    </componentList>
    <allowComponentSelection>1</allowComponentSelection>
    <componentsDirectory>.</componentsDirectory>
    <componentsDownloadDirectory>C:\</componentsDownloadDirectory>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <vendor>Bonitasoft</vendor>
    <customLanguageFileList>
        <language>
            <code>en</code>
            <encoding>utf-8</encoding>
            <file>${build_project_directory}/I18n/messages.properties</file>
        </language>
    </customLanguageFileList>
</project>

